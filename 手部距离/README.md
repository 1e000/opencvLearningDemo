# 手掌检测与距离测量系统

基于OpenCV和MediaPipe的实时手掌检测与距离测量系统，支持iPhone LiDAR深度数据获取。

## 功能特性

- 🖐️ **实时手掌检测**: MediaPipe高精度手掌识别
- 📏 **距离测量**: 基于LiDAR的精确距离计算
- 📱 **跨平台**: iPhone + Mac协同工作
- 🔄 **实时传输**: 低延迟网络数据传输
- 📊 **可视化**: 实时显示RGB和深度图像

## 文件说明

- `demo.py`: Mac端主程序，负责接收数据、检测手掌、计算距离
- `iPhone_ViewController.swift`: iPhone端应用，负责采集和传输数据
- `requirements.txt`: Python依赖包列表

## 快速开始

### 1. 环境准备

**Mac端要求:**
- Python 3.7+
- OpenCV 4.x
- MediaPipe
- NumPy

**iPhone端要求:**
- iOS 13.0+
- 支持LiDAR的设备 (iPhone 12 Pro及以上)

### 2. 安装依赖

```bash
# 安装Python依赖
pip install -r requirements.txt
```

### 3. 运行程序

**Mac端:**
```bash
python demo.py
```

**iPhone端:**
1. 使用Xcode打开`iPhone_ViewController.swift`
2. 配置网络连接参数（修改IP地址）
3. 部署到设备并运行

### 4. 使用说明

1. 启动Mac端程序，等待连接
2. 启动iPhone应用，自动连接
3. 在摄像头前展示手掌
4. 查看实时距离显示

## 技术架构

### 网络通信
- **协议**: TCP
- **端口**: 9999
- **数据格式**: 
  - 4字节大小前缀 + RGB数据
  - 4字节大小前缀 + 深度数据

### 数据处理流程
1. iPhone采集RGB和深度数据
2. 通过网络传输到Mac
3. Mac端接收并处理数据
4. MediaPipe检测手掌关键点
5. 计算手掌到摄像头距离
6. 实时显示结果

### 坐标映射
- RGB图像: 640x480
- 深度图像: 256x192
- 自动坐标映射和转换

## 显示界面

### RGB图像
- 显示实时摄像头画面
- 绘制手掌骨架和关键点
- 右上角显示距离信息
- 绿色圆圈标记手掌位置

### 深度雷达图
- 显示LiDAR深度数据
- 白色圆圈标记手掌位置
- 显示具体距离数值
- 显示数据有效性比例

## 调试信息

程序会输出详细的调试信息：
- 网络连接状态
- 数据接收统计
- 手掌检测结果
- 深度数据有效性
- 距离计算结果

## 故障排除

### 常见问题

1. **连接失败**
   - 检查网络连接
   - 确认IP地址配置
   - 检查防火墙设置

2. **手掌检测失败**
   - 确保光线充足
   - 手掌完整展示
   - 调整检测参数

3. **深度数据无效**
   - 确认设备支持LiDAR
   - 检查ARKit权限
   - 确保环境适合深度检测

### 性能优化

- 降低帧率减少网络压力
- 调整图像分辨率
- 优化检测参数
- 使用更快的网络连接

## 扩展功能

- 多手掌同时检测
- 手势识别
- 距离趋势分析
- 数据记录和回放
- 自定义手势控制

## 许可证

MIT License
